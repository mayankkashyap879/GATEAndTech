# ============================================================================
# GATE And Tech - Environment Configuration
# ============================================================================
# Copy this file to .env and update with your actual values
# NEVER commit .env to version control - it contains sensitive credentials

# ============================================================================
# DATABASE (Required)
# ============================================================================
# PostgreSQL connection string
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?options
# For local development: use sslmode=disable
# For production: use sslmode=require with a proper SSL certificate
DATABASE_URL="postgresql://postgres:password@localhost:5432/gateandtech_dev?sslmode=disable"

# ============================================================================
# SESSION & SECURITY (Required)
# ============================================================================
# Session secret for encrypting session cookies (min 32 characters)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
SESSION_SECRET="replace-with-random-32-character-string-minimum"

# Environment mode: development | production | test
NODE_ENV="development"

# Application port (default: 5000, firewalled on other ports)
PORT="5000"

# Application URL (for email links, OAuth callbacks, etc.)
APP_URL="http://localhost:5000"

# ============================================================================
# REDIS (Optional - Graceful Degradation)
# ============================================================================
# Redis connection for caching, sessions, and BullMQ job queues
# Supports redis:// (unencrypted) and rediss:// (TLS encrypted)
# Format: redis://[username]:password@host:port/database
# Leave empty to run without Redis (less performant but functional)
# Recommended for production with Upstash or DigitalOcean Managed Redis
REDIS_URL=""
# Example Upstash: rediss://:password@region.upstash.io:port
# Example Local: redis://localhost:6379

# ============================================================================
# RAZORPAY PAYMENT GATEWAY (Optional)
# ============================================================================
# Required for paid test series and purchases
# Get credentials from: https://dashboard.razorpay.com/app/keys
RAZORPAY_KEY_ID=""
RAZORPAY_KEY_SECRET=""
RAZORPAY_WEBHOOK_SECRET=""

# ============================================================================
# OAUTH PROVIDERS (Optional)
# ============================================================================
# Google OAuth 2.0
# Setup: https://console.cloud.google.com/apis/credentials
# Authorized redirect URIs: {APP_URL}/api/auth/google/callback
GOOGLE_CLIENT_ID=""
GOOGLE_CLIENT_SECRET=""

# GitHub OAuth
# Setup: https://github.com/settings/developers
# Authorization callback URL: {APP_URL}/api/auth/github/callback
GITHUB_CLIENT_ID=""
GITHUB_CLIENT_SECRET=""

# ============================================================================
# EMAIL SERVICE (Optional - Console Fallback)
# ============================================================================
# SMTP configuration for sending transactional emails
# If not configured, emails will be logged to console
# Supports: Gmail, SendGrid SMTP, AWS SES, custom SMTP servers

# SMTP Server Configuration
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_SECURE="false"  # true for port 465, false for other ports

# SMTP Authentication
SMTP_USER="your-email@gmail.com"
SMTP_PASS="your-app-password"  # For Gmail: Use app password, not account password

# Email Sender
SMTP_FROM="noreply@gateandtech.com"  # Must be verified with your provider

# Gmail Setup:
# 1. Enable 2FA on your Google account
# 2. Generate App Password: https://myaccount.google.com/apppasswords
# 3. Use App Password in SMTP_PASS

# SendGrid SMTP:
# SMTP_HOST="smtp.sendgrid.net"
# SMTP_PORT="587"
# SMTP_USER="apikey"
# SMTP_PASS="your-sendgrid-api-key"

# ============================================================================
# FILE STORAGE (Optional)
# ============================================================================
# DigitalOcean Spaces or AWS S3 compatible storage
# Used for: question images, invoices, reports, user avatars
SPACES_ENDPOINT=""  # e.g., https://nyc3.digitaloceanspaces.com
SPACES_KEY=""
SPACES_SECRET=""
SPACES_BUCKET=""  # e.g., gateandtech-assets
SPACES_REGION=""  # e.g., nyc3

# ============================================================================
# ERROR TRACKING & MONITORING (Optional)
# ============================================================================
# Sentry for error tracking and performance monitoring
# Get DSN from: https://sentry.io/
SENTRY_DSN=""
SENTRY_ENVIRONMENT="development"  # development | staging | production

# ============================================================================
# CAPTCHA (Optional)
# ============================================================================
# hCaptcha for bot protection on registration and sensitive forms
# Get keys from: https://www.hcaptcha.com/
HCAPTCHA_SECRET=""
HCAPTCHA_SITEKEY=""  # Also needs to be configured in frontend

# ============================================================================
# WORKER CONFIGURATION (Optional)
# ============================================================================
# BullMQ job queue configuration
WORKER_CONCURRENCY="10"  # Number of concurrent jobs per worker
WORKER_MAX_JOBS_PER_SECOND="100"  # Rate limiting for job processing

# Queue namespaces (auto-configured)
# - test-scoring: Score test attempts
# - analytics-update: Update percentiles and statistics
# - report-generation: Generate admin reports
# - invoice-generation: Create and email invoices
# - notification: Send notifications and reminders
# - import: Bulk question import processing
# - gamification: Process points, badges, and streaks

# ============================================================================
# RATE LIMITING (Optional)
# ============================================================================
# Rate limit configuration for API endpoints
RATE_LIMIT_WINDOW_MS="900000"  # 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS="100"  # Max requests per window

# Auth endpoint limits (stricter)
AUTH_RATE_LIMIT_WINDOW_MS="900000"  # 15 minutes
AUTH_RATE_LIMIT_MAX_REQUESTS="5"  # Max 5 login attempts

# ============================================================================
# FEATURE FLAGS (Optional)
# ============================================================================
# Enable/disable features without code changes
FEATURE_DISCUSSIONS="true"  # Community discussions
FEATURE_GAMIFICATION="true"  # Points, badges, leaderboards
FEATURE_ADAPTIVE_TESTS="false"  # AI-powered adaptive testing (Post-MVP)
FEATURE_BULK_IMPORT="true"  # CSV/QTI question import

# ============================================================================
# ANALYTICS & TRACKING (Optional)
# ============================================================================
# PostHog for product analytics
POSTHOG_API_KEY=""
POSTHOG_HOST="https://app.posthog.com"

# Google Analytics
GA_TRACKING_ID=""

# ============================================================================
# DEVELOPMENT TOOLS (Development Only)
# ============================================================================
# Enable debug logging
DEBUG="false"

# Database query logging
DB_LOGGING="false"

# Seed database on startup (development only)
SEED_DATABASE="false"

# ============================================================================
# NOTES & BEST PRACTICES
# ============================================================================
# 1. Security:
#    - Use strong, unique secrets for SESSION_SECRET
#    - Rotate secrets regularly in production
#    - Never commit .env to version control
#    - Use environment-specific .env files (.env.production, .env.staging)
#
# 2. Production Checklist:
#    - Set NODE_ENV=production
#    - Use SSL/TLS for DATABASE_URL (sslmode=require)
#    - Use rediss:// for encrypted Redis connections
#    - Enable Sentry for error tracking
#    - Configure SMTP with verified domain
#    - Set up proper OAuth callback URLs with your domain
#    - Enable rate limiting with appropriate limits
#    - Use managed services (DigitalOcean, AWS) for database and Redis
#
# 3. Development Setup:
#    - Local Postgres: docker run -p 5432:5432 -e POSTGRES_PASSWORD=password postgres
#    - Local Redis: docker run -p 6379:6379 redis
#    - Generate secrets: npm run generate-secrets (to be added)
#
# 4. Testing:
#    - Use separate test database: gateandtech_test
#    - Create .env.test for test-specific configuration
#
# ============================================================================
